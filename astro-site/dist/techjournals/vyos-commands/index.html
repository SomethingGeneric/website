<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><title>Astro</title><style>body{background-color:#000;color:#0f0;font-family:Courier New,Courier,monospace}a{color:#0f0}
</style></head> <body>  <h1 id="vyos-cheatsheet">VyOS Cheatsheet</h1>
<h3 id="changing-user-password">Changing user password</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span>set system login user vyos authentication plaintext-password PasswordGoesHere</span></span>
<span class="line"><span>commit</span></span>
<span class="line"><span>save</span></span>
<span class="line"><span>exit</span></span>
<span class="line"><span></span></span></code></pre>
<p>from: <a href="https://support.vyos.io/support/solutions/articles/103000096301-set-change-the-password-of-a-user">https://support.vyos.io/support/solutions/articles/103000096301-set-change-the-password-of-a-user</a></p>
<h3 id="changing-hostname">Changing hostname</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span>set system host-name fw01-matt</span></span>
<span class="line"><span>commit</span></span>
<span class="line"><span>save</span></span>
<span class="line"><span>exit </span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="set-system-dns-server">Set system DNS server</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span>set system name-server IPHERE</span></span>
<span class="line"><span>commit ; save ; exit</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="setting-interfaces">Setting interfaces</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span>set interfaces ethernet eth0 description SEC350-WAN</span></span>
<span class="line"><span>set interfaces ethernet eth0 address IPADDRESS/MASK</span></span>
<span class="line"><span>commit</span></span>
<span class="line"><span>save</span></span>
<span class="line"><span>exit</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="upstream-gateway">Upstream gateway</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span>set protocols static route 0.0.0.0/0 next-hop GATEWAYIPHERE</span></span>
<span class="line"><span>commit ; save ; exit</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="nat--dns-forwarding">NAT &#x26; DNS Forwarding</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span>set nat source rule 10 description "NAT FROM DMZ to WAN"</span></span>
<span class="line"><span>set nat source rule 10 outbound-interface eth0</span></span>
<span class="line"><span>set nat source rule 10 source address 172.16.50.0/29</span></span>
<span class="line"><span>set nat source rule 10 translation address masquerade</span></span>
<span class="line"><span>commit ; save ; exit</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="dns-forwarding-from-subnets">DNS Forwarding from subnets</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span>set service dns forwarding listen-address 172.16.50.2</span></span>
<span class="line"><span>set service dns forwarding allow-from 172.16.50.0/29</span></span>
<span class="line"><span>set service dns forwarding system</span></span>
<span class="line"><span>commit ; save ; exit</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="end-steps-done-in-lab-11-sec350">End steps done in lab 1.1 (sec350)</h2>
<h3 id="remote-syslog-for-vyos">Remote syslog for VyOS</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span>set system syslog host 172.16.50.5 facility authpriv level info</span></span>
<span class="line"><span>commit ; save ; exit</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="setting-up-zone-policy">Setting up zone policy</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span></span></span>
<span class="line"><span>set zone-policy zone &#x3C;NAME> interface ethX</span></span>
<span class="line"><span>set zone-policy zone &#x3C;NAME> from &#x3C;NAME> firewall name &#x3C;SOME_FIREWALL></span></span>
<span class="line"><span># repeat if you have more than one inbound for this zone</span></span>
<span class="line"><span></span></span>
<span class="line"><span># then you need to create the actual firewall configs that go with each zone:</span></span>
<span class="line"><span>set firewall name &#x3C;FROM_ZONE>-to-&#x3C;TO_ZONE> default-action drop</span></span>
<span class="line"><span>set firewall name &#x3C;FROM_ZONE>-to-&#x3C;TO_ZONE> enable-default-log</span></span>
<span class="line"><span></span></span>
<span class="line"><span># allow return traffic:</span></span>
<span class="line"><span>set firewall name &#x3C;FROM_ZONE>-to-&#x3C;TO_ZONE> rule 1 action accept</span></span>
<span class="line"><span>set firewall name &#x3C;FROM_ZONE>-to-&#x3C;TO_ZONE> rule 1 state established enable</span></span>
<span class="line"><span>set firewall name &#x3C;FROM_ZONE>-to-&#x3C;TO_ZONE> rule 1 state related enable</span></span>
<span class="line"><span></span></span>
<span class="line"><span># allow other services</span></span>
<span class="line"><span>set firewall name set firewall name &#x3C;FROM_ZONE>-to-&#x3C;TO_ZONE> rule 10 action accept</span></span>
<span class="line"><span>set firewall name &#x3C;FROM_ZONE>-to-&#x3C;TO_ZONE> rule 10 description "some service forwarding"</span></span>
<span class="line"><span>set firewall name &#x3C;FROM_ZONE>-to-&#x3C;TO_ZONE> rule 10 destination address &#x3C;IP_HERE></span></span>
<span class="line"><span>set firewall name &#x3C;FROM_ZONE>-to-&#x3C;TO_ZONE> rule 10 destination port &#x3C;N></span></span>
<span class="line"><span>set firewall name &#x3C;FROM_ZONE>-to-&#x3C;TO_ZONE> rule 10 protocol &#x3C;TCP/UDP></span></span>
<span class="line"><span></span></span>
<span class="line"><span># repeat above block with a different rule ID (e.g. 11, etc) for other services that need to pass a given firewall</span></span>
<span class="line"><span></span></span>
<span class="line"><span>commit ; save ; exit</span></span>
<span class="line"><span></span></span></code></pre>
<p>If you need to debug a given firewall, easiest way is to temporarily:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span>set firewall name &#x3C;BROKEN_FIREWALL_NAME> default-action accept</span></span>
<span class="line"><span>commit;save;exit</span></span>
<span class="line"><span></span></span></code></pre>
<p>To see if that firewall is indeed the problem.</p>
<h2 id="rip">RIP</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>configure</span></span>
<span class="line"><span></span></span>
<span class="line"><span>set protocols rip interface ethX # which interface to talk to other routers</span></span>
<span class="line"><span>set protocols rip network &#x3C;NETID>/&#x3C;MASK> # advertise this network (it's directly connected to this router)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>commit ; save ; exit</span></span>
<span class="line"><span></span></span></code></pre>  </body></html>