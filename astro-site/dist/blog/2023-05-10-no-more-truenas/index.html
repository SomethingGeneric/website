<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><title>Astro</title><style>body{background-color:#000;color:#0f0;font-family:Courier New,Courier,monospace}a{color:#0f0}
</style></head> <body>  <hr>
<h2 id="layout-srclayoutsmarkdownlayoutastro">layout: /src/layouts/MarkdownLayout.astro</h2>
<hr>
<h2 id="slug-no-more-truenastitle--moving-away-from-truenasauthors-matttags-debian-truenas-nfs-zfs-chewie">slug: no-more-truenas
title:  “Moving away from TrueNAS”
authors: [matt]
tags: [debian, truenas, nfs, zfs, chewie]</h2>
<h1 id="truenas-is-pretty-mediocre">TrueNAS is pretty mediocre</h1>
<p>I only really used it to begin with because a lot of YouTube and online resources reccomend it as a starting place for running your own fileserver.</p>
<p>And, for the record, it is pretty good at doing exactly that.</p>
<p>However, over time, as I’ve spent more time hands-on with Debian and other more traditional server operating systems, it’s been a pain in the ass to adapt other processes around TrueNAS’s web-UI only style of doing things.</p>
<p>So, I decided it was time to get rid of it.</p>
<h2 id="migration-process">Migration process</h2>
<p>I’m not one to do things well-planned in advance, so I burned a USB stick with Debian 11.7, and shut down TrueNAS without any more thought to it.</p>
<p>(For anyone curious, I <em>did</em> check to make sure that nothing important was on the TrueNAS boot device, and instead on the ZFS mirrored disks that I wanted to preserve.)</p>
<p>When my server Chewie was running TrueNAS (first CORE, then later SCALE), the disks were as follows:</p>
<ul>
<li>~250GB SATA SSD (boot device, I have absolutely 0 idea how they partitioned it)</li>
<li>4 TB WDC HDD (ZFS Mirror disk #1)</li>
<li>4 TB WDC HDD (ZFS Mirror disk #2)</li>
</ul>
<p>I had over a terrabyte of disk space used on the total ZFS array, and no other disk large enough to hold all of the data, so I was banking on OpenZFS being as easy to use as I had read online. Thankfully for my sanity, that turned out to be the case.</p>
<p>Like with any other server, the first thing I did was a base Debian install with only “common utils” and “ssh server”, and had the installer do a one-partition setup on the 250GB SSD device.</p>
<p>One I was booted in to my new Debian install, I did some light googling to figure out what I would have to set up for ZFS. Turns out, it’s not hard at all.</p>
<p>Following the instructions from the OpenZFS website (except note that I personally skipped backports, as I think they skimp on stability sometimes) (<a href="https://openzfs.github.io/openzfs-docs/Getting%20Started/Debian/">https://openzfs.github.io/openzfs-docs/Getting%20Started/Debian/</a>)</p>
<p>The instructions are basically the following steps:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span># if you haven't enabled 'contrib' in your /etc/apt/sources.list yet (I hadn't)</span></span>
<span class="line"><span>sudo nano /etc/apt/sources.list</span></span>
<span class="line"><span>sudo apt update</span></span>
<span class="line"><span>sudo apt install build-essential dpkg-dev linux-headers-generic linux-image-generic -y</span></span>
<span class="line"><span>sudo apt install zfs-dkms zfsutils-linux -y</span></span>
<span class="line"><span></span></span></code></pre>
<p>Now since I had the ZFS kernel module, I had to reboot.</p>
<p>Next, I ran across this AskUbuntu post (<a href="https://askubuntu.com/questions/123126/how-do-i-mount-a-zfs-pool">https://askubuntu.com/questions/123126/how-do-i-mount-a-zfs-pool</a>), which kind’ve answered my question in a round-about way.</p>
<p>My pool had been named “Storag” in TrueNAS (not sure where the “e” went. Oh well), so I tried</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>sudo zpool import Storag</span></span>
<span class="line"><span></span></span></code></pre>
<p>And to my suprise, it worked!</p>
<p>(Side note, the OP in the thread (or maybe a reply?) mentioned this older blog post, of someone doing much what I was, but I didn’t end up needing it. <a href="https://web.archive.org/web/20171211140530/http://www.servercobra.com/freenas-to-ubuntu-initial-fileserver-setup-with-zfs">https://web.archive.org/web/20171211140530/http://www.servercobra.com/freenas-to-ubuntu-initial-fileserver-setup-with-zfs</a>)</p>
<p>Then, all I had to do was figure out how to set up NFS shares (as I had previously only used TrueNAS’s awful webUI for it.)</p>
<p>Turns out, this too, was super easy.</p>
<p>This Atlantic.net article was super helpful (once you scroll past their quick self-advertisement): <a href="https://www.atlantic.net/dedicated-server-hosting/how-to-install-and-configure-nfs-server-on-debian-11/">https://www.atlantic.net/dedicated-server-hosting/how-to-install-and-configure-nfs-server-on-debian-11/</a></p>
<p>TL;DR for Debian:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>sudo apt-get update -y</span></span>
<span class="line"><span>sudo apt-get install nfs-kernel-server -y</span></span>
<span class="line"><span></span></span></code></pre>
<p>Then you need to edit <code>/etc/exports</code> like:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>/some_path 10.0.0.69(rw,sync,no_subtree_check)</span></span>
<span class="line"><span></span></span></code></pre>
<p>(The article documents the options in the <code>()</code>’s, and the IP is made up.)</p>
<p>Finally, you just</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>sudo systemctl restart nfs-server</span></span>
<span class="line"><span></span></span></code></pre>
<p>And, done!</p>
<h2 id="conclusion">Conclusion</h2>
<p>Obviously for some people the migration of TrueNAS could be more complex, but personally, half the reason I felt the need to move was because I wasn’t using the machine for anything but ZFS and NFS, as I find the webUI just that frustrating.</p>
<p>It would obviously have been more taxing to migrate if I had been running apps from the TrueNAS marketplace still, but if that had been true, I probably wouldn’t have been motivated to switch the machine at all.</p>
<p>Hopefully this short post can be SEO’d well enough to help out someone else! :D</p>  </body></html>